<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packaging Catalog</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body, #root { background: #ffffff !important; }
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; 
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: #ffffff;
        transition: background-color 0.3s, color 0.3s;
      }
      
      /* Dark mode styles */
      body.dark-mode { background: #1a1a1a !important; color: #e0e0e0; }
      .dark-mode .container { background: #1a1a1a; }
      .dark-mode .header { background: #1a1a1a; border-bottom-color: #333; }
      .dark-mode .logo { color: #fff; }
      .dark-mode .product-card { background: #1a1a1a; border-right-color: #333; border-bottom-color: #333; }
      .dark-mode .product-card:hover { background-color: #222; }
      .dark-mode .product-image { background: #1a1a1a; }
      .dark-mode .product-name { color: #fff; }
      .dark-mode .product-component { color: #ccc; }
      .dark-mode .product-meta { color: #999; }
      .dark-mode .product-grid { border-top-color: #333; }
      .dark-mode .filter-label { color: #999; }
      .dark-mode .filter-option { color: #999; }
      .dark-mode .filter-option:hover { color: #fff; }
      .dark-mode .filter-option.active { color: #fff; }
      .dark-mode .search-box { background: #222; border-color: #333; color: #fff; }
      .dark-mode .search-box:focus { border-color: #555; }
      .dark-mode .logout-btn, .dark-mode .refresh-btn, .dark-mode .clear-filters-btn { 
        background: #222; 
        border-color: #333; 
        color: #ccc; 
      }
      .dark-mode .logout-btn:hover, .dark-mode .refresh-btn:hover, .dark-mode .clear-filters-btn:hover { 
        background: #2a2a2a; 
        border-color: #444; 
        color: #fff; 
      }
      .dark-mode .results-count { color: #999; }
      .dark-mode .filter-group-scrollable::-webkit-scrollbar-track { background: #222; }
      .dark-mode .filter-group-scrollable::-webkit-scrollbar-thumb { background: #444; }
      .dark-mode .sidebar-content::-webkit-scrollbar-track { background: #222; }
      .dark-mode .sidebar-content::-webkit-scrollbar-thumb { background: #444; }
      
      .dark-mode-toggle {
        padding: 7px 14px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        background: #fff;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        margin-left: 10px;
        transition: all 0.15s;
      }
      .dark-mode-toggle:hover { border-color: #999; background: #fafafa; }
      .dark-mode .dark-mode-toggle { background: #222; border-color: #333; color: #ccc; }
      .dark-mode .dark-mode-toggle:hover { background: #2a2a2a; border-color: #444; color: #fff; }
      
      .container { max-width: 100%; margin: 0 auto; padding: 0 24px; }
      .sidebar { width: 220px; flex-shrink: 0; }
      .sidebar-content { position: sticky; top: 100px; max-height: calc(100vh - 120px); overflow-y: auto; padding-right: 8px; }
      .sidebar-content::-webkit-scrollbar { width: 6px; }
      .sidebar-content::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
      .sidebar-content::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
      .sidebar-content::-webkit-scrollbar-thumb:hover { background: #999; }
      .main-content { flex: 1; min-width: 0; }
      .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 0; border-top: 1px solid #e0e0e0; }
      .product-card { 
        border-right: 1px solid #e0e0e0;
        border-bottom: 1px solid #e0e0e0;
        transition: background-color 0.15s;
        cursor: pointer;
        background: #fff;
      }
      .product-card:hover { background-color: #f8f8f8; }
      .product-image { 
        height: 250px; 
        background: #fff; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        padding: 20px; 
        flex-shrink: 0;
      }
      .product-image img { 
        max-width: 100%; 
        max-height: 100%; 
        object-fit: contain;
      }
      .filter-group { margin-bottom: 28px; }
      .filter-group-scrollable { max-height: 200px; overflow-y: auto; margin-top: 8px; padding-right: 8px; }
      .filter-group-scrollable::-webkit-scrollbar { width: 4px; }
      .filter-group-scrollable::-webkit-scrollbar-track { background: #f5f5f5; border-radius: 2px; }
      .filter-group-scrollable::-webkit-scrollbar-thumb { background: #ddd; border-radius: 2px; }
      .filter-group-scrollable::-webkit-scrollbar-thumb:hover { background: #ccc; }
      .filter-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: #999; margin-bottom: 8px; }
      .filter-option { padding: 6px 0; cursor: pointer; color: #666; font-size: 14px; transition: color 0.15s; }
      .filter-option:hover { color: #000; }
      .filter-option.active { color: #000; font-weight: 500; }
      .search-box { width: 100%; padding: 10px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 14px; font-family: inherit; }
      .search-box:focus { outline: none; border-color: #999; }
      .product-info { padding: 16px; display: flex; flex-direction: column; }
      .product-name { font-size: 13px; font-weight: 600; color: #000; margin-bottom: 4px; letter-spacing: 0.3px; }
      .product-component { font-size: 13px; color: #666; margin-bottom: 12px; }
      .product-meta { font-size: 12px; color: #999; line-height: 1.6; }
      .header { border-bottom: 1px solid #e0e0e0; padding: 18px 0; background: #fff; position: sticky; top: 0; z-index: 100; }
      .logo { font-size: 16px; font-weight: 600; color: #000; letter-spacing: 0.5px; }
      .logout-btn { padding: 7px 14px; border: 1px solid #e0e0e0; border-radius: 4px; background: #fff; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.15s; }
      .logout-btn:hover { border-color: #999; background: #fafafa; }
      .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #fff; }
      .login-box { background: #fff; padding: 48px; border: 1px solid #e0e0e0; border-radius: 4px; max-width: 400px; width: 100%; }
      .login-input { width: 100%; padding: 12px 14px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 14px; margin-bottom: 16px; font-family: inherit; }
      .login-input:focus { outline: none; border-color: #999; }
      .login-btn { width: 100%; padding: 12px; background: #000; color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 0.15s; }
      .login-btn:hover { background: #333; }
      .results-count { font-size: 13px; color: #999; margin-bottom: 20px; font-weight: 500; }
      .clear-filters-btn { width: 100%; padding: 9px; border: 1px solid #e0e0e0; border-radius: 4px; background: #fff; cursor: pointer; font-size: 12px; font-weight: 500; margin-bottom: 20px; color: #666; transition: all 0.15s; }
      .clear-filters-btn:hover { border-color: #999; background: #fafafa; color: #000; }
      .refresh-btn { padding: 7px 14px; border: 1px solid #e0e0e0; border-radius: 4px; background: #fff; cursor: pointer; font-size: 13px; font-weight: 500; margin-left: 10px; transition: all 0.15s; }
      .refresh-btn:hover { border-color: #999; background: #fafafa; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
          GOOGLE_SHEET_ID: '17loO452it-qoRcwNKp5nbZg0exuBRZt794sTOmrkwEY',
          PASSWORD: 'testck',
          IMAGE_BASE_URL: 'https://raw.githubusercontent.com/josephkimkuma/packaging_catalog/main/images',
          IMAGE_EXTENSION: '.png',
          FACTORY_FOLDERS: {
            'Taesung': 'taesung',
          }
        };
        // ============================================
        
        const PackagingCatalog = () => {
          const [isAuthenticated, setIsAuthenticated] = useState(() => {
            const authTime = localStorage.getItem('authTime');
            if (authTime) {
              const hoursSinceAuth = (Date.now() - parseInt(authTime)) / (1000 * 60 * 60);
              return hoursSinceAuth < 1;
            }
            return false;
          });
          const [password, setPassword] = useState('');
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedCategory, setSelectedCategory] = useState('all');
          const [selectedFactory, setSelectedFactory] = useState('all');
          const [selectedLocation, setSelectedLocation] = useState('all');
          const [selectedVolume, setSelectedVolume] = useState('all');
          const [selectedShape, setSelectedShape] = useState('all');
          const [selectedMaterial, setSelectedMaterial] = useState('all');
          const [products, setProducts] = useState([]);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState('');
          const [darkMode, setDarkMode] = useState(() => {
            const saved = localStorage.getItem('darkMode');
            return saved === 'true';
          });

          useEffect(() => {
            if (darkMode) {
              document.body.classList.add('dark-mode');
            } else {
              document.body.classList.remove('dark-mode');
            }
          }, [darkMode]);

          useEffect(() => {
            const loadProductsFromSheet = async () => {
              if (!isAuthenticated) return;
              
              try {
                setLoading(true);
                setError('');
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${CONFIG.GOOGLE_SHEET_ID}/export?format=csv`;
                const response = await fetch(sheetUrl);
                if (!response.ok) throw new Error('Failed to load sheet');
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                  header: true,
                  skipEmptyLines: true,
                  complete: (results) => {
                    const parsedProducts = results.data.map((row, index) => {
                      const itemNumber = row['Item #'] || row['Item#'] || '';
                      const factoryName = row['Factory name'] || row['Factory Name'] || '';
                      const category = row['Category'] || '';
                      const component = row['Component'] || '';
                      const fillVolume = row['Fill volume'] || row['Fill Volume'] || '';
                      const factoryLocation = row['Factory location'] || '';
                      const shape = row['Shape'] || '';
                      const material = row['Material'] || '';
                      const imageValue = row['Image'] || '';
                      
                      const factoryFolder = CONFIG.FACTORY_FOLDERS[factoryName] || CONFIG.FACTORY_FOLDERS[factoryName.trim()] || 'default';
                      const imageUrl = imageValue || `${CONFIG.IMAGE_BASE_URL}/${factoryFolder}/${itemNumber}${CONFIG.IMAGE_EXTENSION}`;
                      
                      return {
                        id: itemNumber || `product-${index}`,
                        itemNumber,
                        name: component,
                        category,
                        factory: factoryName,
                        volume: fillVolume,
                        location: factoryLocation,
                        shape,
                        material,
                        image: imageUrl
                      };
                    });
                    
                    setProducts(parsedProducts);
                    setError('');
                  },
                  error: () => setError('Error parsing data')
                });
              } catch (err) {
                setError(err.message);
                setProducts([]);
              } finally {
                setLoading(false);
              }
            };

            if (isAuthenticated) loadProductsFromSheet();
          }, [isAuthenticated]);

          const handleLogin = () => {
            if (password.trim() === CONFIG.PASSWORD) {
              setIsAuthenticated(true);
              localStorage.setItem('authTime', Date.now().toString());
              setPassword('');
            } else {
              alert('Incorrect password');
              setPassword('');
            }
          };

          const toggleDarkMode = () => {
            const newMode = !darkMode;
            setDarkMode(newMode);
            localStorage.setItem('darkMode', newMode.toString());
          };

          const clearAllFilters = () => {
            setSelectedCategory('all');
            setSelectedFactory('all');
            setSelectedLocation('all');
            setSelectedVolume('all');
            setSelectedShape('all');
            setSelectedMaterial('all');
            setSearchTerm('');
          };

          const refreshData = () => {
            setIsAuthenticated(false);
            setTimeout(() => setIsAuthenticated(true), 100);
          };

          const categories = ['all', ...new Set(products.map(p => p.category).filter(Boolean))];
          const factories = ['all', ...new Set(products.map(p => p.factory).filter(Boolean))];
          
          // Extract all unique values from comma-separated fields
          const extractUniqueValues = (field, sortNumerically = false) => {
            const allValues = products
              .map(p => p[field])
              .filter(Boolean)
              .flatMap(val => val.split(',').map(v => v.trim()))
              .filter(Boolean);
            
            const uniqueValues = [...new Set(allValues)];
            
            if (sortNumerically) {
              // Sort numerically by extracting numbers
              uniqueValues.sort((a, b) => {
                const numA = parseFloat(a.match(/[\d.]+/)?.[0] || 0);
                const numB = parseFloat(b.match(/[\d.]+/)?.[0] || 0);
                return numA - numB;
              });
            } else {
              uniqueValues.sort((a, b) => a.localeCompare(b));
            }
            
            return ['all', ...uniqueValues];
          };
          
          const locations = extractUniqueValues('location');
          const volumes = extractUniqueValues('volume', true); // Sort numerically
          const shapes = extractUniqueValues('shape');
          const materials = extractUniqueValues('material');

          const filteredProducts = useMemo(() => {
            return products.filter(product => {
              const matchesSearch = !searchTerm || 
                product.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.itemNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.category?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.factory?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.location?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.volume?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.shape?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.material?.toLowerCase().includes(searchTerm.toLowerCase());
              
              const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;
              const matchesFactory = selectedFactory === 'all' || product.factory === selectedFactory;
              
              // Check if selected value exists in comma-separated field
              const matchesLocation = selectedLocation === 'all' || 
                product.location?.split(',').map(v => v.trim()).includes(selectedLocation);
              const matchesVolume = selectedVolume === 'all' || 
                product.volume?.split(',').map(v => v.trim()).includes(selectedVolume);
              const matchesShape = selectedShape === 'all' || 
                product.shape?.split(',').map(v => v.trim()).includes(selectedShape);
              const matchesMaterial = selectedMaterial === 'all' || 
                product.material?.split(',').map(v => v.trim()).includes(selectedMaterial);
              
              return matchesSearch && matchesCategory && matchesFactory && 
                     matchesLocation && matchesVolume && matchesShape && matchesMaterial;
            });
          }, [searchTerm, selectedCategory, selectedFactory, selectedLocation, 
              selectedVolume, selectedShape, selectedMaterial, products]);

          if (!isAuthenticated) {
            return (
              <div className="login-container" style={{ background: '#fff' }}>
                <div className="login-box">
                  <h2 className="logo" style={{ marginBottom: '32px' }}>Packaging Catalog</h2>
                  <input 
                    type="password" 
                    value={password} 
                    onChange={e => setPassword(e.target.value)}
                    onKeyPress={e => e.key === 'Enter' && handleLogin()}
                    placeholder="Password" 
                    className="login-input"
                    autoFocus 
                  />
                  <button onClick={handleLogin} className="login-btn">Login</button>
                </div>
              </div>
            );
          }

          if (loading) {
            return (
              <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#fff' }}>
                <div style={{ textAlign: 'center', color: '#666' }}>Loading...</div>
              </div>
            );
          }

          return (
            <div style={{ background: '#fafafa', minHeight: '100vh' }}>
              <div className="header">
                <div className="container" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                  <div className="logo">Packaging Catalog</div>
                  <div style={{ display: 'flex', gap: '12px' }}>
                    <button onClick={toggleDarkMode} className="dark-mode-toggle">
                      {darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}
                    </button>
                    <button onClick={refreshData} className="refresh-btn">Refresh</button>
                    <button onClick={() => {
                      setIsAuthenticated(false);
                      localStorage.removeItem('authTime');
                    }} className="logout-btn">Logout</button>
                  </div>
                </div>
              </div>

              {error && (
                <div className="container" style={{ marginTop: '24px' }}>
                  <div style={{ background: '#fee', border: '1px solid #fcc', padding: '16px', borderRadius: '6px', color: '#c00' }}>
                    {error}
                  </div>
                </div>
              )}

              <div className="container" style={{ display: 'flex', gap: '48px', paddingTop: '32px', paddingBottom: '64px' }}>
                <div className="sidebar">
                  <div className="sidebar-content">
                    <button onClick={clearAllFilters} className="clear-filters-btn">
                      Clear All Filters
                    </button>

                    <div className="filter-group">
                      <input 
                        type="text" 
                        placeholder="Search..." 
                        value={searchTerm}
                        onChange={e => setSearchTerm(e.target.value)}
                        className="search-box"
                      />
                    </div>

                    <div className="filter-group">
                      <div className="filter-label">Category</div>
                      <div className="filter-group-scrollable">
                        {categories.map(cat => (
                          <div 
                            key={cat}
                            className={`filter-option ${selectedCategory === cat ? 'active' : ''}`}
                            onClick={() => setSelectedCategory(cat)}
                          >
                            {cat === 'all' ? 'All Categories' : cat}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="filter-group">
                      <div className="filter-label">Factory</div>
                      <div className="filter-group-scrollable">
                        {factories.map(fac => (
                          <div 
                            key={fac}
                            className={`filter-option ${selectedFactory === fac ? 'active' : ''}`}
                            onClick={() => setSelectedFactory(fac)}
                          >
                            {fac === 'all' ? 'All Factories' : fac}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="filter-group">
                      <div className="filter-label">Location</div>
                      <div className="filter-group-scrollable">
                        {locations.map(loc => (
                          <div 
                            key={loc}
                            className={`filter-option ${selectedLocation === loc ? 'active' : ''}`}
                            onClick={() => setSelectedLocation(loc)}
                          >
                            {loc === 'all' ? 'All Locations' : loc}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="filter-group">
                      <div className="filter-label">Volume</div>
                      <div className="filter-group-scrollable">
                        {volumes.map(vol => (
                          <div 
                            key={vol}
                            className={`filter-option ${selectedVolume === vol ? 'active' : ''}`}
                            onClick={() => setSelectedVolume(vol)}
                          >
                            {vol === 'all' ? 'All Volumes' : vol}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="filter-group">
                      <div className="filter-label">Shape</div>
                      <div className="filter-group-scrollable">
                        {shapes.map(shp => (
                          <div 
                            key={shp}
                            className={`filter-option ${selectedShape === shp ? 'active' : ''}`}
                            onClick={() => setSelectedShape(shp)}
                          >
                            {shp === 'all' ? 'All Shapes' : shp}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="filter-group">
                      <div className="filter-label">Material</div>
                      <div className="filter-group-scrollable">
                        {materials.map(mat => (
                          <div 
                            key={mat}
                            className={`filter-option ${selectedMaterial === mat ? 'active' : ''}`}
                            onClick={() => setSelectedMaterial(mat)}
                          >
                            {mat === 'all' ? 'All Materials' : mat}
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>

                <div className="main-content">
                  <div className="results-count">
                    {filteredProducts.length} {filteredProducts.length === 1 ? 'result' : 'results'}
                  </div>

                  <div className="product-grid">
                    {filteredProducts.map(p => (
                      <div key={p.id} className="product-card">
                        <div className="product-image">
                          <img 
                            src={p.image} 
                            alt={p.name}
                            onError={e => e.target.src = 'https://via.placeholder.com/400?text=No+Image'}
                          />
                        </div>
                        <div className="product-info">
                          <div className="product-name">{p.itemNumber}</div>
                          <div className="product-component">{p.name}</div>
                          <div className="product-meta">
                            {p.category && <div>Category: {p.category}</div>}
                            {p.factory && <div>Factory: {p.factory}</div>}
                            {p.location && <div>Location: {p.location}</div>}
                            {p.volume && <div>Volume: {p.volume}</div>}
                            {p.shape && <div>Shape: {p.shape}</div>}
                            {p.material && <div>Material: {p.material}</div>}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {filteredProducts.length === 0 && (
                    <div style={{ textAlign: 'center', padding: '64px 0', color: '#999' }}>
                      No products found
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<PackagingCatalog />, document.getElementById('root'));
    </script>
</body>
</html>
