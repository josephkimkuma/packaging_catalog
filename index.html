<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packaging Catalog</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        const PackagingCatalog = () => {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [password, setPassword] = useState('');
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedCategory, setSelectedCategory] = useState('all');
          const [selectedSupplier, setSelectedSupplier] = useState('all');
          const [showFilters, setShowFilters] = useState(false);
          const [showUpload, setShowUpload] = useState(false);
          const [products, setProducts] = useState([]);
          const [uploadError, setUploadError] = useState('');

          const ADMIN_PASSWORD = 'packaging2024';

          useEffect(() => {
            const loadProducts = async () => {
              try {
                const saved = localStorage.getItem('packaging-products');
                if (saved) {
                  setProducts(JSON.parse(saved));
                } else {
                  setProducts(getSampleProducts());
                }
              } catch (error) {
                setProducts(getSampleProducts());
              }
            };
            loadProducts();
          }, []);

          useEffect(() => {
            if (products.length > 0) {
              localStorage.setItem('packaging-products', JSON.stringify(products));
            }
          }, [products]);

          const getSampleProducts = () => [
            {
              id: 'PKG-001', itemNumber: 'PKG-001', name: 'Airless Pump Bottle',
              category: 'Pumps', supplier: 'Supplier A',
              description: 'Premium airless pump bottle with silver finish',
              volume: '30ml', size: '120mm x 35mm', material: 'PP/Acrylic', color: 'Silver',
              image: 'https://images.unsplash.com/photo-1556229010-6c3f2c9ca5f8?w=400', link: '#'
            },
            {
              id: 'PKG-002', itemNumber: 'PKG-002', name: 'Glass Dropper Bottle',
              category: 'Bottles', supplier: 'Supplier B',
              description: 'Amber glass bottle with dropper',
              volume: '50ml', size: '100mm x 40mm', material: 'Glass', color: 'Amber',
              image: 'https://images.unsplash.com/photo-1608571423902-eed4a5ad8108?w=400', link: '#'
            }
          ];

          const handleLogin = () => {
            if (password.trim() === ADMIN_PASSWORD) {
              setIsAuthenticated(true);
              setPassword('');
            } else {
              alert('Incorrect password. Try: packaging2024');
              setPassword('');
            }
          };

          const handleCSVUpload = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const text = event.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                if (lines.length < 2) {
                  setUploadError('CSV must have headers and data');
                  return;
                }
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                const newProducts = [];
                for (let i = 1; i < lines.length; i++) {
                  const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                  const product = {};
                  headers.forEach((header, index) => {
                    product[header] = values[index] || '';
                  });
                  product.id = product.itemNumber || `PKG-${Date.now()}-${i}`;
                  newProducts.push(product);
                }
                setProducts(prev => [...prev, ...newProducts]);
                setUploadError('');
                setShowUpload(false);
                alert(`Imported ${newProducts.length} products!`);
              } catch (error) {
                setUploadError('Error parsing CSV');
              }
            };
            reader.readAsText(file);
          };

          const downloadTemplate = () => {
            const csv = 'itemNumber,name,category,supplier,description,volume,size,material,color,image,link\nPKG-001,Example,Bottles,Supplier,Description,50ml,100mm,Glass,Clear,https://example.com/img.jpg,#';
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'template.csv';
            a.click();
          };

          const exportData = () => {
            const headers = ['itemNumber','name','category','supplier','description','volume','size','material','color','image','link'];
            const csv = headers.join(',') + '\n' + products.map(p => headers.map(h => `"${p[h]||''}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `catalog-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
          };

          const clearAllData = () => {
            if (confirm('Clear all products?')) {
              setProducts([]);
              localStorage.removeItem('packaging-products');
            }
          };

          const categories = ['all', ...new Set(products.map(p => p.category).filter(Boolean))];
          const suppliers = ['all', ...new Set(products.map(p => p.supplier).filter(Boolean))];

          const filteredProducts = useMemo(() => {
            return products.filter(product => {
              const matchesSearch = !searchTerm || 
                product.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.itemNumber?.toLowerCase().includes(searchTerm.toLowerCase());
              const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;
              const matchesSupplier = selectedSupplier === 'all' || product.supplier === selectedSupplier;
              return matchesSearch && matchesCategory && matchesSupplier;
            });
          }, [searchTerm, selectedCategory, selectedSupplier, products]);

          if (!isAuthenticated) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                  <div className="flex justify-center mb-6">
                    <div className="w-16 h-16 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl flex items-center justify-center text-white text-3xl font-bold">P</div>
                  </div>
                  <h2 className="text-2xl font-bold text-center mb-2">Packaging Catalog</h2>
                  <p className="text-center text-gray-600 mb-6">Enter password to access</p>
                  <input type="password" value={password} onChange={e => setPassword(e.target.value)}
                    onKeyPress={e => e.key === 'Enter' && handleLogin()}
                    placeholder="Password" className="w-full px-4 py-3 border rounded-lg mb-4" autoFocus />
                  <button onClick={handleLogin} className="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold">Login</button>
                  <p className="mt-6 text-xs text-center text-gray-500">Default: packaging2024</p>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-50">
              <header className="bg-white border-b sticky top-0 z-10">
                <div className="max-w-7xl mx-auto px-4 py-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <div className="w-10 h-10 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg text-white font-bold flex items-center justify-center">P</div>
                      <h1 className="text-2xl font-bold">Packaging Catalog</h1>
                    </div>
                    <div className="flex space-x-2">
                      <button onClick={() => setShowUpload(true)} className="px-4 py-2 bg-purple-600 text-white rounded-lg">Upload</button>
                      <button onClick={() => setShowFilters(!showFilters)} className="px-4 py-2 bg-gray-100 rounded-lg">Filters</button>
                      <button onClick={() => setIsAuthenticated(false)} className="px-4 py-2 bg-gray-100 rounded-lg">Logout</button>
                    </div>
                  </div>
                </div>
              </header>

              {showUpload && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-lg">
                    <div className="flex justify-between mb-4">
                      <h3 className="text-xl font-bold">Upload Products</h3>
                      <button onClick={() => setShowUpload(false)} className="text-gray-400">âœ•</button>
                    </div>
                    <div className="space-y-4">
                      <button onClick={downloadTemplate} className="w-full px-4 py-2 bg-gray-100 rounded-lg">Download Template</button>
                      <input type="file" accept=".csv" onChange={handleCSVUpload} className="w-full" />
                      {uploadError && <p className="text-red-600 text-sm">{uploadError}</p>}
                      <div className="flex space-x-2">
                        <button onClick={exportData} disabled={!products.length} className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg disabled:bg-gray-300">Export</button>
                        <button onClick={clearAllData} disabled={!products.length} className="px-4 py-2 bg-red-600 text-white rounded-lg disabled:bg-gray-300">Clear</button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              <div className="bg-white border-b">
                <div className="max-w-7xl mx-auto px-4 py-4">
                  <input type="text" placeholder="Search..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)}
                    className="w-full px-4 py-3 border rounded-lg" />
                  {showFilters && (
                    <div className="mt-4 grid md:grid-cols-2 gap-4">
                      <select value={selectedCategory} onChange={e => setSelectedCategory(e.target.value)} className="px-3 py-2 border rounded-lg">
                        {categories.map(c => <option key={c} value={c}>{c === 'all' ? 'All Categories' : c}</option>)}
                      </select>
                      <select value={selectedSupplier} onChange={e => setSelectedSupplier(e.target.value)} className="px-3 py-2 border rounded-lg">
                        {suppliers.map(s => <option key={s} value={s}>{s === 'all' ? 'All Suppliers' : s}</option>)}
                      </select>
                    </div>
                  )}
                </div>
              </div>

              <div className="max-w-7xl mx-auto px-4 py-4">
                <p className="text-gray-600">Showing {filteredProducts.length} of {products.length} items</p>
              </div>

              <main className="max-w-7xl mx-auto px-4 pb-12">
                <div className="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                  {filteredProducts.map(p => (
                    <div key={p.id} className="bg-white rounded-lg shadow hover:shadow-md transition">
                      <img src={p.image || 'https://via.placeholder.com/400'} alt={p.name} className="w-full h-64 object-cover rounded-t-lg" />
                      <div className="p-4">
                        <div className="flex justify-between mb-2">
                          <h3 className="font-semibold">{p.name}</h3>
                          <span className="text-xs text-gray-500">{p.itemNumber}</span>
                        </div>
                        <p className="text-sm text-gray-600 mb-3">{p.description}</p>
                        <div className="space-y-1 text-sm">
                          {p.category && <div className="flex justify-between"><span className="text-gray-500">Category:</span><span>{p.category}</span></div>}
                          {p.supplier && <div className="flex justify-between"><span className="text-gray-500">Supplier:</span><span>{p.supplier}</span></div>}
                          {p.volume && <div className="flex justify-between"><span className="text-gray-500">Volume:</span><span>{p.volume}</span></div>}
                          {p.size && <div className="flex justify-between"><span className="text-gray-500">Size:</span><span>{p.size}</span></div>}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                {filteredProducts.length === 0 && (
                  <div className="text-center py-12">
                    <p className="text-gray-500">No products found</p>
                    <button onClick={() => { setSearchTerm(''); setSelectedCategory('all'); setSelectedSupplier('all'); }}
                      className="mt-4 px-6 py-2 bg-purple-600 text-white rounded-lg">Clear Filters</button>
                  </div>
                )}
              </main>
            </div>
          );
        };

        ReactDOM.render(<PackagingCatalog />, document.getElementById('root'));
    </script>
</body>
</html>